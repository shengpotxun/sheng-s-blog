---
title: 'AuDI:利用周期性通信实现自主物联网设备类型识别'
tags: 物联网
categories: 论文阅读
mathjax: true
katex: true
feature: true
cover: 'http://tva1.sinaimg.cn/large/008tudqVgy1h569oxzasgj31z4141u0x.jpg'
abbrlink: c3842e90
date: 2022-08-14 14:10:05
---
# 背景介绍

物联网设备本质上可以是移动的，因此是动态的。与通用计算设备相比，它们也更加异构。 不同的物联网设备具有不同的服务质量 (QoS) 要求，例如网络带宽或对丢包的容忍度。 例如，连接的摄像头（流式传输时视频）比智能灯泡需要更高的带宽。连接的烟雾探测器或智能钥匙锁与智能咖啡机相比需要更可靠的通信。有的情况消息传递失败可能会危及生命（比如烟雾探测器）或让安全性岌岌可危（比如钥匙锁）。 商品物联网设备的安全性常常令人沮丧。一些设备带着易于利用的安全漏洞定期被投放到市场 [1]-[3]。 这种异质性增加和弱安全性显着提高了管理物联网网络的难度。

有一种方法来处理这些问题，这个方法基于一种现象那就是相同类型的物联网设备对QoS和安全的要求往往相似。 例如，来自同一设备制造商的高端 IP 摄像机可能有类似的带宽要求。 类似的，特定制造商那些运行着相同版本固件的设备会有相同的漏洞（例如，启用
调试模式将打开一个后门 [4])。因此，通过根据设备类型指定 QoS 和安全策略，可以使它们更易于管理。以前的方法是通过使用来自特定已知设备类型的标记数据训练分类模型获得相应的设备指纹策略，用这种策略来辨别设备模型或者特定的软\硬件配置。这样的训练数据需要大量的人力来生成和维护，鉴于越来越多的各种物联网设备制造商，这尤其困难。

# 系统模型

## 模型与需求

我们主要针对典型的SOMO系统模型提出方案(AUDI)，在这种模型下物联网设备通过一个能正常工作的网关来链接互联网。而AUDI的主要目标是让网关能够识别接上自己的设备种类。这种识别基于网关和接入设备之间的被动监测网络通信，因此，AUDI必须满足以下要求

- **自动化**：无需标记的训练数据也能在有限的人工干预下进行操作
- **拓展性**：能够管理大量的设备并且在新的设备出现的时候识别它们
- **稳定性**：不管目标物联网设备处于哪个生命周期(感应、正常操作)是哪种操作模式(待机、与用户交互)都能够持续有效的运作(快速、准确)
- **安全性**：能够抵御通过修改受感染设备的通信、试图伪装成不同设备类型的对手进行的欺骗攻击

## 系统设计

**物联网网关(IoT Gateway)** 充当互联网的本地访问网关。例如，通过 WiFi 或以太网，物联网设备连接到它。除了充当本地网络中连接设备的网关路由器外，物联网网关还托管 AUDI 设备指纹组件，该组件监控连接的物联网设备的通信模式然后提取设备指纹（详见第 III 和 IV 节）

**物联网云服务(IoT Cloud Service)** 是一个基于云的功能，在上面托管了AUDI设备类型识别组件(AUDI Device-Type Identification component)，该组件使用基于机器学习的分类器，这个分类器根据物联网网关提供的设备指纹来判断物联网设备类型。物联网云服务汇聚多个物联网网关的指纹，来学习设备类型识别模型(详细信息请参阅 IV-B)。聚合有助于提高总体准确性，因为在任何给定物联网网关处观察到的物联网通信量可能很小。

AUDI自动生成并分配抽象标签，AUDI用这种抽象标签来表示单个的设备类型。这个过程在根据每个物联网设备的通信模式构建指纹的时候一并做好了。然后，奥迪使用无监督聚类算法自动将这些指纹分组到集群中，并为每个集群创建一个抽象标签(详情见章节IV-B)。整个过程不需要任何人工干预。值得注意的是，奥迪在开始运营时没有任何设备类型的识别模型。随着物联网网关聚合更多的数据，它学习并改进设备类型识别模型。

## 具体设备类型策略

AUDI提供的设备类型识别可用于多种方式。我们在这里简要地概述了体系结构方法和一些可能的用法，但请读者参考我们的并发工作[12]以获得详细的描述。图1展示架构是根据设备类型制定策略，增强物联网网络管理能力的一种架构

![图一架构](http://tva1.sinaimg.cn/mw690/008tudqVgy1h56s563u7zj30f40ditbz.jpg)

> 图一架构

首先，我们通过一个策略数据库来增强物联网云服务，该数据库将一组策略与每个检测到的设备类型关联起来。当物联网网关检测到某一类型的设备时，可以从策略数据库中检索一致的策略。可以集中制定策略(例如,由专家)或在每个物联网网关上本地学习并聚合在策略数据库中。一些特定设备类型(device-type-specific)的应用示例如下：

- **异常检测(Anomaly detection)** :通过监测指定类型的设备，物联网网关可以得到一个有关设备正常工作的配置文件，并将本地学习的行为配置文件整合到特定设备类型的全局异常检测配置文件中。当物联网网关检测到特定类型的新设备时，它可以从物联网云服务搜索这个类型的异常检测配置文件，并立刻使用配置文件来检测任何和这个设备相关的异常行为。这个情况在[12]中有详细描述。
- **网络资源分配(Ntework resource allocation)** :通过监测一段时间内特定设备类型的通信，物联网网关可以了解这个类型在网络带宽等方面的要求。同样，可以整合从不同物联网网关获取的需求，以便新的物联网网关可以毫无延迟地向新检测到的设备调配网络资源。
- **识别和隔离易受攻击的物联网设备(Identification and isolate valurable IoT device)** :设备类型可以通过使用漏洞报告链接到已知漏洞，如[5]中所建议的。一旦物联网网关检测到已知其类型存在漏洞的设备，它可以使用软件定义的网络技术[13]来强制实施限制设备[5]的通信的策略。此类策略在物联网云服务策略库中指定。

## 设备类型识别概述

传统的设备类型识别方法[6]、[7]依赖于从密集网络流量中提取的整合统计数据。由于物联网设备的通信稀缺，传统方法的应用是无效的。物联网设备几乎不会产生密集的流量，通常只在罕见且短暂的用户交互期间才会产生。然而，物联网设备也会产生独立于用户交互的后台通信。这种流量始终存在，相对恒定且有周期性

因此，基于物联网设备周期性的背景网络流量，我们引入了一种新的技术来识设备的类型。与现有方法相比，该技术可以在设备运行的任何状态下识别物联网设备的类型，包括待机状态，恒定时间为30分钟。我们的技术依赖于在网络网关对网络流量的被动监控，由三个步骤组成：步骤1：推断周期性流量的周期和、稳定性(Sect.III)，步骤2：根据设备的周期性流量提取表示设备类型的指纹(Sec.IV-A)，步骤3：在识别设备类型的分类系统中使用该指纹((Sect. IV-B)。图2是识别过程的概述。步骤1和2在物联网网关中实施，而步骤3在物联网云服务中实施。

![图二](http://tva1.sinaimg.cn/mw690/008tudqVgy1h56s600265j30gv0eyjxa.jpg)

> 图二

# 周期性流量推理

傅立叶变换和信号自相关是推断周期的有效信号处理技术。虽然傅立叶变换和信号自相关可以识别信号的几个不同的周期，忽略了大多数非周期噪声，但这些技术在应用于纯单周期信号时更准确。因此，我们对物联网网关收到的网络流量进行了预处理，并将其划分为不同的流。我们将流定义为一串使用给定通信协议(例如，NTP、ARP、RTSP等)从给定源MAC地址(物联网设备)发送出去的网络分组序列。流量划分的基本原理是，大多数周期性通信使用的专用协议不同于用于与用户交互相关的通信的专用协议(非周期性)。如果周期性和非周期性通信仍然在流量(例如，HTTP)中共存，则傅立叶变换和信号自相关可以更好地应对这种降低的非周期性噪声。

网络捕获中的数据包流必须转换为适合信号处理的格式。我们将每个数据包流离散为以每秒一个值采样的二进制时间序列，以指示流在1秒周期(值1)内是否包含一个或多个包(值0)。所计算出来的时间序列是持续时间为$d$秒的离散二进制信号$y(t)$

我们首先使用离散傅立叶变换(DFT)[14]来确定给定流量的候选周期。DFT将离散信号$y(t)$从时域转换到频域：$y(t)\Longrightarrow Y(f)$。$Y(f)$为每个$f\in [0;1]$的频率提供振幅值。由列表中的产生最大振幅值$Y(f_i)=\max(Y(f))$ 的频率$f_i$给出$y(t)$中主导周期(dominant period)的周期性$T_i=\frac d{f_i}$也存在振幅值较低的二次周期$T_j$。在候选的周期$T_i$中，我们选择振幅值$Y(\frac d{T_i})$超过之前的最大振幅值$Y(f_i)=\max(Y(f))$至少10%的周期$T_i$。我们通过只选择$Y$的局部极大值抛弃了接近的获选周期。如果$Y(f-1)<Y(f)>Y(f+1)$，我们就说$Y(f)$取得了局部最大值。这操作的结果是流量的候选周期列表。

使用DFT(离散傅里叶变换)找到的候选周期表可能不准确或者不存在。为了确认并提炼这些片段，我们计算了离散信号$y(t)$的离散自相关，记为$R_{yy}$。$R_{yy}$是一个函数，函数随着时间推移表示信号$y(t)$与其自身的相似性。如果$R_{yy}$在偏移量$l$处很大并且取得了局部最大值，这说明$y(t)$很有可能是周期的，并且周期为$l$，并且这个周期在$y(t)$上面重复$R_{yy}(l)$次。上面已经说过我们要对每个已经做过离散傅里叶变换(DFT)的候选片段$T_i$进行确认和提炼，而这个方法就是计算每个$T_i$的偏移量$l_i\in[0.9\times T_i;1.1\times T_i]$这个区间上的$R_{yy}(l_i)$的值。如果这里面包含一个局部最大值$R_{yy}(l_i)=lmax_i$，我们就确认在这个范围内存在一个周期，并且把这个周期的大小更新为$T_i=l_i$。$R_{yy}(l_i)$被视作在$R_{yy}(l_i-i)<R_{yy}(l_i)<R_{yy}(l_i+1)$。对于每个算出来的结果周期$T_i$，我们都要计算对应的特征度量(charateristic metrics)$r_i$和$rn_i$。下面给出定义

$$
r_i=\frac{T_i\times R_{yy}(T_i)}{d}	\space \space\space\space(1) \\\\ rn_i=\frac{T_i\times(R_{yy}(T_i-1)+R_{yy}(T_i)+R_{yy}(T_i+1))}{d}\space \space\space\space (2)
$$

$r_i$计算周期$T_i$出现的次数与信号$y(t)$持续时间$d$的比例。周期$T_i$准确而稳定的周期信号会让$r_i$等于1。但是，周期信号很有可能会有噪声($r_i<1$)或者也有可能会有周期相同的平行周期。这就是对计算$rn$的基本原理的解释，其中我们把相邻的周期的出现次数相加。周期$T_i$稳定的周期信号产生的结果应该是$r_i\approx rn_i\approx 1$，相对的不稳定周期信号的结果就是$r_i<1,r_i\ll rn_i$对于流量的进行周期推测的最终结果应该是一个有着对应比例的周期：$\{(T_1,r_1,rn_1),\cdots,(T_i,r_i,rn_i),\cdots,(T_n,r_n,rn_n) \}$

**举例**：图三是从D-LingCam DCS935L IP相机的数据流中提取的二进制时间序列图像，我们可以看到所有被画出来的流量都是周期性的。对这些时间序列施行DFT和自相关操作之后，我们会得到以下结果：
![图三](http://tva1.sinaimg.cn/mw690/008tudqVgy1h56s6qbji3j30gm0a2mzh.jpg)

> **图三**：从D-LinkCam DCS926L IP相机数据流量中提取出四个二进制时间序列。这个数据流符合ARP协议、HTTPS(端口(pot)443)、mDNS(端口(pot)5353)以及TCP协议(端口62976)，所有数据流都是周期的

```
ARP:	(period:55, r:0.735, rn:0.857)
HTTPS:	(period:55, r:0.857, rn:1.102)
mDNS:	(period:25, r:2.171, rn:4.399)
port	62976:	(period:30, r:0.969, rn:0.969)
```

我们发现我们的方法能够准确推断图三中所有被观测到的周期。符合端口62976 TCP协议的数据流量是最稳定的周期(30s)而被高亮显示，它的特征值最符合规律$r=rn\approx1$。而ARP以及HTTPS(端口 443)同样有一个稍微没那么稳定的55s周期，因为在高亮中我们可以看出$r$值更小，并且$r$和$rn$之间的差值更大。与此同时我们也对mDNS(端口 5353)数据流的25s周期进行了推理。但正如同我们在图三中所看到的那样，在这个数据流中有三个不同的信号标志(signals)有25s的周期性。通过呈现出来的高$r$值和高$rn$值，即远高于1的值，在周期推理中我们也能够发现这一方面(指三个不同的信号标志)，这些结果表明我们的方法能够检测周期流量，准确的推断它们的周期并用$r$值和$rn$值来刻画它们。

# 设备类型识别

通过对周期流量的特征提取，我们可以为设备类型创建指纹。这些特征之后被用来进行无监督机器学习算法，然后创建并为指纹分配设备类型标签

## 指纹提取

我们把一个$x$秒的网络流量捕获分成三个子网络流量捕获，$\left[ 0,\frac x2 \right],\left[ \frac x4,\frac{3x}4 \right],\left [ \frac x2,x \right]$，简称子捕获(实际上捕获就是更小一截的流量)。我们对每个子捕获和一整个父捕获$[0,x]$执行周期流量推理(第三大章全部内容)。最后我们每个流量获得四个周期(分别来源于一段大的网络流量捕获分析以及三个小的)以及对应的$r$值和$rn$值。对于更小的子捕获执行周期推测的目的有两个。第一，通过舍弃从少于两个子捕获推断出的周期来获得更准确的效果(符合少于两个子捕获，这个周期就无效)。第二，我们可以通过$r$值和$rn$值计算出数据衡量它们的稳定性。

周期推理的结果按照MAC源进行分组并链接到单个设备。这个分组定义了特征提取的粒度，也就是每个MAC源地址和每个捕获提取一个指纹。我们引入33个特征来创造我们的设备指纹。这些特征是手动设计的，旨在以一种独特的方式对一组周期性流量进行建模，从而能够区分设备类型。需要注意的是，我们所有的特征都是用周期性流量推理过程(第三大章全部)中获得的统计数据算出来的。它们不使用来自传输层以上协议的数据包有效荷载信息或数据包报头信息，因此，AuDI可以在任何传输层以上的加密流量中执行。一共有四类特征共33个将在下面和表1中进行讨论。

**周期流量Periodic flow(9 个)** :这一类特征表示了周期性流量的数量和质量。它包括周期流量计数 **(1)** 、支持周期流量的协议层(layer of protocols) **(2)** 、是否是单周期或者多周期 **(3~6)** 、周期流量源端口是否发生改变 **(7)** 和发生这个改变的频率 **(8~9)**

**周期精度Periodic accuracy(3 个)** :这一类特征测量了所推理周期的准确性以及它们提取的噪声程度，包括从子捕获和全捕获中推理获得的周期计数 **(10)** ，以及从中推断出每个周期的子捕获计数的平均值 **(11)** 和标准偏差 **(12)** 。

**周期持续时间Period duration (4 个)** :这一类特征 **(13~16)** 表示在四个时间段里面的周期数，例如$[5s,29s]$。这个时间段是手动选取的，目的是根据相对持续时间来对周期进行分类：$[5s,29s];[30s,59s];[60s,119s];[120s,600s]$。一些小于$5s$和大于$10$分钟的周期应该被舍弃。识别长周期需要更长时间的流量捕获，这会降低指纹提取速度

**周期稳定性Period stability (17个)** :在这个分类的特征用$r$值和$rn$值代表推理出的周期的稳定性，具体可以看我们在第三大章讨论的内容。根据每个流量和周期得到的$r$值和$rn$值计算平均数和标准差。把所有$r$值平均数分为四个分组，计算每个分组里面有多少个有效值，得到特征 **17~20** ，同样我们把所有$rn$平均数分为四个分组，计算每个分组里有多少有效值，获得特征 **24~27** 。通过设置平均$r$值和$rn$值的分组区间来区分噪声区间：$[0.2,0.7]$和纯单周期流量区间：$[0.7,1]$以及不同的多周期流量区间：$[1,2),[2,+\infty)$。通过类似的三分组计数$r$值标准差得到特征 **21~23** 三分组计数$rn$值标准差得到特征 **28~30** 。通过设置标准差分组区间来区分：非常稳定的周期流量区间：$[0,0.02]$，稳定的周期流量区间：$[0.02,0.1]$，和不稳定的周期流量区间：$[0.1,+\infty)$。特征 **31~33** 是通过将差$rn−r$的值分成三个值范围并对对应分组进行计数计算出来的。这个分组选取目的是为了表示稳定周期和非稳定周期之间的差异。

> **表一**：使用33个特征(4种)识别设备类型。# 表示计数，SD表示标准差。使用ReliefF算法计算重要性得分 [15]。高分数(绿色)对应最相关特征，而低分数(红色)对应最不相关。

| 种类         | f  | 说明                                                   |          重要性          |
| ------------ | -- | :----------------------------------------------------- | :----------------------: |
| 周期流量     | 1  | # 周期流量                                             | $\color{green}{0.440}$ |
| 周期流量     | 2  | # 周期流量(协议小于4层)                                | $\color{green}{0.465}$ |
| 周期流量     | 3  | 每个流量的平均周期                                     |  $\color{red}{0.068}$  |
| 周期流量     | 4  | 每个流量的标准差                                       |  $\color{red}{0.037}$  |
| 周期流量     | 5  | # 只有一个周期的流量                                   | $\color{green}{0.429}$ |
| 周期流量     | 6  | # 多个周期的流量                                       | $\color{black}{0.176}$ |
| 周期流量     | 7  | # 静态源端口的流量                                     | $\color{green}{0.533}$ |
| 周期流量     | 8  | 源端口改变的平均频率                                   | $\color{black}{0.310}$ |
| 周期流量     | 9  | 源端口改变的SD频率                                     | $\color{black}{0.137}$ |
| 周期精度     | 10 | # 能被所有子捕获中推理出来的周期                       | $\color{black}{0.329}$ |
| 周期精度     | 11 | 周期推理成功的平均值                                   |  $\color{red}{0.037}$  |
| 周期精度     | 12 | 周期推理成功的方差                                     |  $\color{red}{0.022}$  |
| 周期持续时间 | 13 | # 在区间$[5s,29s]$上的周期                           | $\color{green}{0.409}$ |
| 周期持续时间 | 14 | # 在区间$[30s,59]$上的周期                           | $\color{green}{0.408}$ |
| 周期持续时间 | 15 | # 在区间$[60s,119s]$上的周期                         | $\color{green}{0.467}$ |
| 周期持续时间 | 16 | # 在区间$[120s,600s]$上的周期                        | $\color{green}{0.419}$ |
| 周期稳定性   | 17 | # 在区间$[0.2,0.7)$上的$r$值均值                   | $\color{black}{0.386}$ |
| 周期稳定性   | 18 | # 在区间$[0.7,1)$上的$r$值均值                     | $\color{green}{0.436}$ |
| 周期稳定性   | 19 | # 在区间$[1,2)$上的$r$值均值                       | $\color{black}{0.239}$ |
| 周期稳定性   | 20 | # 在区间$[2,+\infty)$上的$r$值均值                 | $\color{black}{0.124}$ |
| 周期稳定性   | 21 | # 在区间$[0,02)$上的$r$值标准差                    | $\color{black}{0.185}$ |
| 周期稳定性   | 22 | # 在区间$[0.02,0.1)$上的$r$值标准差                | $\color{black}{0.151}$ |
| 周期稳定性   | 23 | # 在区间$[0.1,+\infty)$上的$r$值标准差             | $\color{black}{0.185}$ |
| 周期稳定性   | 24 | # 在区间$[0.2,0.7)$上的$rn$值均值                  | $\color{black}{0.288}$ |
| 周期稳定性   | 25 | # 在区间$[0.7,1)$上的$rn$值均值                    | $\color{black}{0.307}$ |
| 周期稳定性   | 26 | # 在区间$[1,2)$上的$rn$值均值                      | $\color{black}{0.313}$ |
| 周期稳定性   | 27 | # 在区间$[2,+\infty)$上的$rn$值均值                | $\color{black}{0.246}$ |
| 周期稳定性   | 28 | # 在区间$[0,0.02)$上的$rn$值标准差                 | $\color{black}{0.217}$ |
| 周期稳定性   | 29 | # 在区间$[0.02,0.1)$上的$rn$值标准差               | $\color{black}{0.217}$ |
| 周期稳定性   | 30 | # 在区间$[0.1,+\infty)$上的$rn$值标准差            | $\color{black}{0.220}$ |
| 周期稳定性   | 31 | # 在区间$[0,0.02)$上的$rn$值均值减$r$值均值      | $\color{green}{0.408}$ |
| 周期稳定性   | 32 | # 在区间$[0.02,0.1)$上的$rn$值均值减$r$值均值    | $\color{black}{0.248}$ |
| 周期稳定性   | 33 | # 在区间$[0.1,+\infty)$上的$rn$值均值减$r$值均值 | $\color{green}{0.482}$ |

## 设备指纹分类

我们的设备识别技术旨在完全自动。它不需要人工交互，也不需要标记数据进行操作。当物联网设备接入物联网网关时，物联网网关监控设备网络流量并提取一个指纹，详见第四大章第一部分。这个指纹将会被送到物联网云端服务器，云服务尝试识别拥有这个指纹的设备类型。如果指纹匹配，就成功识别设备类型，并且使用指纹重新训练并改进模型。如果找不到匹配项，云服务就用这个指纹去学习新的新的设备类型模型。

AuDI在没有任何识别模型的情况下开始运行。随着物联网云服务从物联网网关接受指纹，它讲创建类型标识符并学习一个标志模型(举例，表二中类型#12)。系统运行的时间越长，物联网网关对它的贡献就越大，这个系统能够识别的类型就越多，并且识别也更加准确。

我们使用KNN算法实现自动设备类型识别。选择KNN是因为它能够处理大量的类和不平衡的数据集。每种设备类型用一个类别表示并且对于不同的类别来说训练数据可能是不平衡的(因为物联网设备部署的时候不同)。KNN形成至少$k$个相邻小簇来表示一个类型。在监督模式下多个簇可以定义一个类型，捕获潜在的多样性。这允许我们利用已知类型的设备上收集到的指纹来创造具有相同类型标签的新集群。当遇到模型未知设备类型的指纹时，它们被检测超过分类模型最近的簇的阈值距离。可以向模型中加入一个新的类表示这个未知的设备类型。

我们的特征经过处理之后不需要复杂的关系去区分设备类型。因此我们只用欧几里得距离量来作为KNN中的距离量。我们所有33个指纹特征都是在范围$[0,1]$中被缩放的。目的是在分类任务的时候获得一个相对公平的权重。我们从30分钟的网络流量中提取指纹。我们测试了几个捕获持续时间段：$\{ 5,10,20,30,60,90 \}$。小于30分钟的时间段会错过长周期的流量，降低识别准确性。超过30分钟的持续时间不会增加识别准确性，但是增加了设备识别延迟。我们设置$k=5$来满足，学习类代表性和训练数据需要的权衡。如果我们获得了一个新设备的五个指纹，也就是学习了2.5个小时之后，我们的模型就可以学习到它的类型。

我们的指纹分类方法不需要任何标记数据就可以实现，它允许AuDI聚集指纹并管理聚集后的簇，这样AuDI就能够不依赖人工学习并标记设备类型。在部署AuDI之前，有四个参数要进行调整和定义：流量捕获时长、流量采样周期、$k$值以及KNN的阈值举例。这些参数的最优解
